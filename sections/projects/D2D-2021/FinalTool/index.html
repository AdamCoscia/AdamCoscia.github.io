<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Final Tool</title>
    <script src="js/libs/jquery-3.6.0.min.js"></script>
    <script src="js/libs/jquery.csv.min.js"></script>
    <script src="js/libs/split.min.js"></script>
    <script src="js/libs/d3.min.js"></script>
    <script src="js/libs/geotiff.js"></script>
    <link rel="stylesheet" href="css/MapView.css" />
    <link rel="stylesheet" href="css/3DView.css" />
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        overflow: hidden;
      }

      #view {
        display: flex;
        width: 100%;
        height: 75vh;
      }

      #view > * {
        flex: 1 1 50%;
      }

      #editor {
        display: flex;
        width: 100%;
        height: 25vh;
      }

      #editor > * {
        flex: 1 1 50%;
      }

      .modal-mask {
        position: fixed;
        z-index: 9998;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: table;
        transition: opacity 0.3s ease;
      }

      .modal-wrapper {
        display: table-cell;
        vertical-align: middle;
      }

      .modal-container {
        width: 500px;
        margin: 0px auto;
        padding: 20px 30px;
        background-color: #fff;
        border-radius: 2px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.33);
        transition: all 0.3s ease;
        font-family: Helvetica, Arial, sans-serif;
      }

      .modal-header {
        margin-top: 0;
        font-size: 1.2rem;
        font-weight: 800;
        color: #42b983;
      }

      .modal-body {
        font-size: 0.8rem;
        margin: 20px 0;
      }

      .modal-footer {
        overflow: hidden;
      }

      .modal-enter {
        opacity: 0;
      }

      .modal-leave-active {
        opacity: 0;
      }

      .modal-enter .modal-container,
      .modal-leave-active .modal-container {
        -webkit-transform: scale(1.1);
        transform: scale(1.1);
      }
    </style>
  </head>

  <body>
    <div id="app">
      <div id="view">
        <div id="plot-container">
          <svg id="svg"></svg>
        </div>
        <div id="threed-container">
          <canvas id="c"></canvas>
        </div>
      </div>

      <div id="editor">
        <div id="map-controls">
          <div id="map-grid">
            <div style="grid-column: 1 /4; text-align: center">
              <h2 style="margin: 0; display: inline-block">Inputs</h2>
              &nbsp;
              <div class="numberCircle">i</div>
            </div>

            <span style="grid-column: 1; place-self: end center">Cruise</span>
            <span style="grid-column: 2; place-self: end center">Background</span>
            <span style="grid-column: 3; place-self: end center">Site</span>
            <!-- <span style="grid-column: 3; place-self: end center">Units</span> -->

            <select style="grid-column: 1" id="map-file-select">
              <option>Pescadero_final.csv</option>
              <option>SantaMonica_GeoChem_repeat.csv</option>
            </select>
            <select style="grid-column: 2" id="bg-select"></select>
            <select style="grid-column: 3" id="site-select"></select>
            <!-- <select style="grid-column: 3" id="units-select">
                <option>Degrees</option>
                <option>Centimeters</option>
              </select> -->

            <div style="grid-column: 1 / 4; height: 2px; margin: 0.25rem 0"></div>

            <span style="grid-column: 1; place-self: center right">Y max</span>
            <input style="grid-column: 2" type="text" id="y-max-input" />

            <span style="grid-column: 1; place-self: center right">Y min</span>
            <input style="grid-column: 2" type="text" id="y-min-input" />

            <input style="grid-column: 2" type="text" id="x-min-input" />
            <input style="grid-column: 3" type="text" id="x-max-input" />

            <button style="grid-column: 1" id="reset-btn">Reset</button>

            <span style="grid-column: 2; place-self: start center">X min</span>
            <span style="grid-column: 3; place-self: start center">X max</span>

            <div style="grid-column: 1 / 4; height: 2px; margin: 0.25rem 0"></div>

            <div style="grid-column: 1 /4; text-align: center">
              <h2 style="margin: 0; display: inline-block">Outputs</h2>
            </div>

            <span style="grid-column: 1; place-self: center right">X Scale</span>
            <span style="grid-column: 2 / 4; place-self: center left" id="x-scale-output"></span>

            <span style="grid-column: 1; place-self: center right">Y Scale</span>
            <span style="grid-column: 2 / 4; place-self: center left" id="y-scale-output"></span>

            <span style="grid-column: 1 / 4; place-self: end center" id="cylinder-output-title">
              Currently visible cylinders (0):
            </span>
            <span style="grid-column: 1 / 4; justify-self: center" id="cylinder-output"> No file loaded. </span>
          </div>
        </div>

        <div id="threed-controls">
          <div id="input-grid">
            <div style="grid-column: 1 /4">
              <h2>Inputs</h2>
              &nbsp;
              <div class="numberCircle">i</div>
            </div>

            <span style="grid-column: 1; place-self: end center">File</span>
            <span style="grid-column: 2; place-self: end center">Shape</span>
            <select style="grid-column: 1" id="3d-file-select">
              <option>Pescadero_3d_natural_5cm.csv</option>
              <option>Pescadero_3d_natural_10cm.csv</option>
              <option>Pescadero_3d_natural_15cm.csv</option>
              <option>Pescadero_3d_linear_5cm.csv</option>
              <option>Pescadero_3d_linear_10cm.csv</option>
              <option>Pescadero_3d_linear_15cm.csv</option>
            </select>
            <select style="grid-column: 2" id="shape-select">
              <option>Prism</option>
              <option>Cylinder</option>
            </select>

            <span style="grid-column: 1; place-self: end center">Variable</span>
            <span style="grid-column: 2; place-self: end center">Color Map</span>
            <select style="grid-column: 1" id="variable-select">
              <option>Sulfide</option>
              <option>Sulfate</option>
              <option>Archaea;__Euryarchaeota;__Methanomicrobia;__ANME_1;__f;__g</option>
              <option>Archaea;__Euryarchaeota;__Methanomicrobia;__Methanosarcinales;__ANME_2c;__g</option>
              <option>
                Bacteria;__Proteobacteria;__Deltaproteobacteria;__Desulfobacterales;__Desulfobacteraceae;__SEEP_SRB1
              </option>
              <option>
                Bacteria;__Proteobacteria;__Deltaproteobacteria;__Desulfobacterales;__Desulfobulbaceae;__SEEP_SRB2
              </option>
              <option>
                Bacteria;__Proteobacteria;__Deltaproteobacteria;__Desulfobacterales;__Desulfobulbaceae;__SEEP_SRB4
              </option>
            </select>
            <select style="grid-column: 2" id="cmap-select">
              <option>Viridis</option>
              <option>Cividis</option>
              <option>Greys</option>
              <option>Inferno</option>
              <option>Plasma</option>
              <option>Magma</option>
            </select>
          </div>

          <div id="threed-controls-grid">
            <div style="grid-column: 1 /3">
              <h2>Camera</h2>
              <span id="camera-sliders-toggle-icon">&#x25BC;</span>
              <button style="float: right; border-radius: 7px" id="camera-reset-btn">Reset</button>
            </div>

            <div style="grid-column: 1 / 3" id="camera-sliders">
              <span style="grid-column: 2; place-self: center left">Field of View</span>
              <span style="grid-column: 1; text-align: right" id="fov-output"></span>
              <input style="grid-column: 2" type="range" min="0" max="150" id="fov-input" />

              <span style="grid-column: 2; place-self: center left">Near Clipping Place</span>
              <span style="grid-column: 1; text-align: right" id="near-output"></span>
              <input type="range" min="0.1" step="0.1" id="near-input" />

              <span style="grid-column: 2; place-self: center left">Far Clipping Place</span>
              <span style="grid-column: 1; text-align: right" id="far-output"></span>
              <input type="range" max="10000" step="0.1" id="far-input" />
            </div>

            <div style="grid-column: 1 /3">
              <h2>View</h2>
              <span id="view-sliders-toggle-icon">&#x25BC;</span>
              <button style="float: right; border-radius: 7px" id="view-reset-btn">Reset</button>
            </div>

            <div style="grid-column: 1 / 3" id="view-sliders">
              <strong style="grid-column: 1; place-self: center left">Options</strong>
              <div style="grid-column: 2 / 5">
                <div style="display: inline-block">
                  <input type="checkbox" id="elevation-toggle-checkbox" disabled />
                  <label for="elevation-toggle-checkbox">Elevation</label>
                </div>
                <div style="float: right">
                  <input type="checkbox" id="interp-toggle-checkbox" checked />
                  <label for="interp-toggle-checkbox">Interpolation</label>
                </div>
              </div>

              <div style="grid-column: 1 / 5; height: 2px; margin: 0.5rem 0"></div>

              <strong style="grid-column: 1 / 4; place-self: center left; color: #c2b280">Grid</strong>
              <div style="grid-column: 4; place-self: center right">
                <input type="checkbox" id="grid-elev-toggle-checkbox" checked />
                <label for="grid-elev-toggle-checkbox">Show</label>
              </div>
              <span style="grid-column: 1; text-align: right" id="grid-elev-output"></span>
              <input style="grid-column: 2 / 5" type="range" min="-30" max="0" id="grid-elev-input" />

              <div style="grid-column: 1 / 5; height: 2px; margin: 0.5rem 0"></div>

              <strong style="grid-column: 1; place-self: center left; color: #0000ff">Latitude</strong>
              <div style="grid-column: 2; place-self: center left">
                <input type="checkbox" id="z-clip-global-checkbox" />
                <label for="z-clip-global-checkbox">Global</label>
              </div>
              <div style="grid-column: 3; place-self: center">
                <input type="checkbox" id="z-clip-flip-checkbox" />
                <label for="z-clip-flip-checkbox">Flip</label>
              </div>
              <div style="grid-column: 4; place-self: center right">
                <input type="checkbox" id="z-clip-helper-checkbox" checked />
                <label for="z-clip-helper-checkbox">Helper</label>
              </div>
              <span style="grid-column: 1; text-align: right" id="z-clip-output"></span>
              <input style="grid-column: 2 / 5" type="range" id="z-clip-input" />

              <div style="grid-column: 1 / 5; height: 2px; margin: 0.5rem 0"></div>

              <strong style="grid-column: 1; place-self: center left; color: #ff0000">Longitude</strong>
              <div style="grid-column: 2; place-self: center left">
                <input type="checkbox" id="x-clip-global-checkbox" />
                <label for="x-clip-global-checkbox">Global</label>
              </div>
              <div style="grid-column: 3; place-self: center">
                <input type="checkbox" id="x-clip-flip-checkbox" />
                <label for="x-clip-flip-checkbox">Flip</label>
              </div>
              <div style="grid-column: 4; place-self: center right">
                <input type="checkbox" id="x-clip-helper-checkbox" checked />
                <label for="x-clip-helper-checkbox">Helper</label>
              </div>
              <span style="grid-column: 1; text-align: right" id="x-clip-output"></span>
              <input style="grid-column: 2 / 5" type="range" id="x-clip-input" />

              <div style="grid-column: 1 / 5; height: 2px; margin: 0.5rem 0"></div>

              <strong style="grid-column: 1; place-self: center left; color: #00ff00">Depth</strong>
              <div style="grid-column: 2; place-self: center left">
                <input type="checkbox" id="y-clip-global-checkbox" />
                <label for="y-clip-global-checkbox">Global</label>
              </div>
              <div style="grid-column: 3; place-self: center">
                <input type="checkbox" id="y-clip-flip-checkbox" />
                <label for="y-clip-flip-checkbox">Flip</label>
              </div>
              <div style="grid-column: 4; place-self: center right">
                <input type="checkbox" id="y-clip-helper-checkbox" checked />
                <label for="y-clip-helper-checkbox">Helper</label>
              </div>
              <span style="grid-column: 1; text-align: right" id="y-clip-output"></span>
              <input style="grid-column: 2 / 5" type="range" id="y-clip-input" />
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal-mask">
      <div class="modal-wrapper">
        <div class="modal-container">
          <div class="modal-header">Map Instructions</div>
          <div class="modal-body">
            <span>1. <strong>Click and drag</strong> on the plot to zoom in to the dragged-over region.</span>
            <br /><br />
            <span>2. <strong>Right-click</strong> on the plot to undo the most recent zoom.</span>
            <br /><br />
            <span>3. <strong>Hover</strong> on a dot in the plot to see information about the cylinder.</span>
            <br /><br />
            <span>4. Click the <strong>Reset</strong> button to return the plot to it's original axis limits.</span>
            <br /><br />
            <span>
              <strong>Note:</strong> When zooming, the plot (1) fits itself to the extents of either (a) the convex hull
              around the points of interest when filtering by site or (b) the drawn rectangle, (2) adjusts each axis to
              be 100m if it is less than, and finally (3) increases the smaller axis to be the same as the larger axis,
              ensuring a square viewport.
            </span>
          </div>

          <div class="modal-header">3D Instructions</div>
          <div class="modal-body">
            <span>1. Left-click and drag to pan.</span>
            <br /><br />
            <span>2. Right-click and drag to rotate.</span>
            <br /><br />
            <span>3. Middle-click and drag or scroll to zoom.</span>
            <br /><br />
          </div>

          <div class="modal-footer">
            <span style="float: left">
              To see this message again, click the
              <strong><span class="numberCircle">i</span> icons</strong>.
            </span>
            <button id="hide-modal-btn" style="float: right">OK</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading Animation -->
    <svg
      version="1.1"
      id="loading-animation"
      xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      x="0px"
      y="0px"
      width="0px"
      height="0px"
      viewBox="0 0 100 100"
      enable-background="new 0 0 0 0"
      xml:space="preserve"
    >
      <path
        fill="#000"
        d="M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50"
      >
        <animateTransform
          attributeName="transform"
          attributeType="XML"
          type="rotate"
          dur="1s"
          from="0 50 50"
          to="360 50 50"
          repeatCount="indefinite"
        />
      </path>
    </svg>

    <script type="module">
      import MapView from "./js/MapView.js";
      import ThreeDView from "./js/3DView.js";

      const mapView = new MapView();
      mapView.init();
      mapView.animate(true);

      const threeDView = new ThreeDView();
      threeDView.init();
      threeDView.animate(true);

      // create the adjustable gutter
      //   Split(["#map-controls", "#threed-controls"], {
      //     // eslint-disable-line new-cap
      //     sizes: [50, 50],
      //     minSize: 350,
      //     elementStyle: (dimension, size, gutterSize) => {
      //       return {
      //         "flex-basis": `calc(${size}% - ${gutterSize}px)`,
      //       };
      //     },
      //     gutterStyle: (dimension, gutterSize) => {
      //       return {
      //         "flex-basis": `${gutterSize}px`,
      //       };
      //     },
      //   });
    </script>
  </body>
</html>
